<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>


       <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-app.js"></script>


<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-database.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyALcyhOcPOEUTgkuAr9tV8fzmOt6eS4mhA",
    authDomain: "mi-game3.firebaseapp.com",
    databaseURL: "https://mi-game3.firebaseio.com",
    projectId: "mi-game3",
    storageBucket: "mi-game3.appspot.com",
    messagingSenderId: "889184952168",
    appId: "1:889184952168:web:3a449e52afa4aad87000dd"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

var database = firebase.database();
      
    


//        // Enable persistence
//        firebase.firestore().enablePersistence()
//            .catch(function(err) {
//            if (err.code == 'failed-precondition') {
//                // If multiple tabs are open, persistence can only be enabled in one tab at a time
//            } else if (err.code == 'unimplemented') {
//                // The current browser does not support all of the features required to enable persistence
//            }
//        }); 

        var uid = "id"

            // login anonymous user
          firebase.auth().signInAnonymously().catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
        });

            firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
            var isAnonymous = user.isAnonymous;
            var uid = user.uid;
            // ...
          } else {
            // User is signed out.
            // ...
          }
          // ...
        });

//

//    firebase.auth().signInAnonymously().catch(function(error) {
//                            // Handle Errors here.
//                            var errorCode = error.code;
//                            var errorMessage = error.message;
//                            console.log(errorMessage);
//                            // ...
//                        });

//        // When signed in, get the user ID
//        firebase.auth().onAuthStateChanged(function(user) {
//                                if (user) {
//                                    console.log("logged in");
//                                    var uid = user.uid;
//                                    console.log('Signed in as ' + uid)
//                                    } else {
//            // No user is signed in.
//          }});


//        if (uid !== null && uid !== undefined){
//            console.log(uid)
//        }else{
//            console.log("stringfailure")
//        };
//

        //Create reference to the database
//        var db = firebase.firestore();

        //Create a document in `db ` for the current participant
//        db.collection("Test").doc("TestDoc").collection("TestPart").doc(uid).set({
////            participantID: participantID, // Refers to the participant's ID from Prolific
//            date: new Date().toLocaleDateString(),
//            time: new Date().toLocaleTimeString()
//        });

//        db.collection("Tasks").doc("mi-game").collection("participants").doc(uid).set({
//                    date: new Date().toLocaleDateString(),
//                    time: new Date().toLocaleTimeString()
//                });


    //Updating an existing field: (an example)
       //db.collection("Tasks").doc('mi-game').collection('participants').doc(uid).update({
       //total_points: number_of_points
       //}); -->

        </script>

        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        </head>
    <body></body>


<script>

        // Define Stimuli
        var balance = jsPsych.randomization.sampleWithReplacement([1, 0], 1)
        var GameType = jsPsych.randomization.sampleWithReplacement([2], 1)
        var pM = [5, 5]
        var pEM = [10, 10]
        var pHit_M1   = "100%"
        var pMiss_M1   = "0%"       
        var pHit_M2   = "100%"
        var pMiss_M2   = "0%"
        var GetDate = jsPsych.data.getURLVariable('date')
        var GetTime = jsPsych.data.getURLVariable('time')
        jsPsych.data.addProperties({
            Pr_M: pM,
            Pr_EM: pEM,
            Color_Order: balance,
            StartDate: GetDate,
            StartTime: GetTime,
        });

        if(balance == 1){
            R1Color      = "#35AA0F"
            R1ColorWord  = "<span class='a-span'>green</span>"
            R1Span       = "<span class='a-span'>Green Game</span>"
            R1BestOdds   = "<span class='a-span'>"+pHit_M1+"</span>"
            R1WorstOdds  = "<span class='a-span'>"+pMiss_M1+"</span>"
            R2Color      = "#339EFF"
            R2ColorWord  = "<span class='b-span'>blue</span>"
            R2Span       = "<span class='b-span'>Blue Game</span>"
            R2BestOdds   = "<span class='b-span'>"+pHit_M2+"</span>"
            R2WorstOdds  = "<span class='b-span'>"+pMiss_M2+"</span>"
        } else {
            R1Color      = "#339EFF"
            R1ColorWord  = "<span class='b-span'>blue</span>"
            R1Span       = "<span class='b-span'>Blue Game</span>"
            R1BestOdds   = "<span class='b-span'>"+pHit_M1+"</span>"
            R1WorstOdds  = "<span class='b-span'>"+pMiss_M1+"</span>"
            R2Color      = "#35AA0F"
            R2ColorWord  = "<span class='a-span'>green</span>"
            R2Span       = "<span class='a-span'>Green Game</span>"
            R2BestOdds   = "<span class='a-span'>"+pHit_M2+"</span>"
            R2WorstOdds  = "<span class='a-span'>"+pMiss_M2+"</span>"
        }

        if (pM[0] < pM[1]) {
            SpeedChng1   = "more"
            SpeedChng2   = "you won't have to respond as fast"
        } else if (pM[0] > pM[1]) {
            SpeedChng1  = "less"
            SpeedChng2  = "you'll have to respond faster"
        }


        var pM50 = jsPsych.randomization.shuffle([
            200, 200, 200, 200, 200, 750, 750, 750, 750, 750,
            ])

        var missoutcome = jsPsych.randomization.shuffle([
            "#cf0000", "#cf0000", "#cf0000", "#cf0000", "#cf0000", 
            "#1067e8", "#1067e8", "#1067e8", "#1067e8", "#1067e8",
            ])

        var ITI = [1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000]

        var hits = -1

        var misses = -1

        var tNum = -1

//        var compchk1 = 0

        /* create timeline */
        var timeline = []

      
        // //Function to check whether consent has been given
        // var check_consent = function(elem) {
        //     if (document.getElementById('consent_checkbox').checked) {
        //     return true;
        //     }
        //     else {
        //         alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
        //         return false;
        //     }
        //     return false;
        // };

        // //Presents external consent page to participants
        // var consent = {
        //     type:'external-html',
        //     url: "consent.html",
        //     cont_btn: "start",
        //     check_fn: check_consent
        // };
        // timeline.push(consent);

        /* define welcome message trial */
        var welcome = {
            type: "html-keyboard-response",
            stimulus: "<div class='parent'>"
            +"<p>Welcome!</p>"
            +"<p>In this survey, you will play a game and answer questions about it.<br>"
            +"When you're ready to begin, press your SPACEBAR to proceed to the next screen.</p></div>"
        }

        var Intro1 = [
        "<div class='parent' style='text-align: left'>"
        +'<p>We are designing games that can be used by behavioral scientists to study motivation and decision making. '
        +"To make the games as engaging as possible, we are getting feedback from people like you.</p>"
        +"<p>You will play a game called the "+R1Span+". Then you will tell us how engaging it was.</p>"
        +"<p>Continue to learn about and play the "+R1Span+".</p>"
        +"<p>Press your SPACEBAR to progress through each screen.</p></div>"]

        var Intro2 = [
        "<div class='parent'>"
        +'<p>The goal of the <span class="green-span">Green Game</span> is to win as many "10-cent Jackpots" as possible.</p>'
        +'<p>For every 10-cent Jackpot you win, you will receive an extra 10 cents. '
        +'At the end of the study, you will receive a $5 eGiftcard for your participation, '
        +'plus an additional 10 cents for each 10-cent Jackpot you won.</p></div>',
        "<div class='parent'>"
        +'<p>To win 10-cent Jackpots, you must stop <span class="green-span">green</span> tiles from changing color.</p>'
        +'<div class="box" style="background-color:#00aa00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>To stop a <span class='green-span'>green</span> tile from changing color, you must press your SPACEBAR as soon as it appears on your screen. "
        +"Thus, whenever you see a <span class='green-span'>green</span> tile (like this one), you should press your SPACEBAR as fast as possible.</p>"
        +'<div class="box" style="background-color:#00aa00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>Each time you stop a <span class='green-span'>green</span> tile from changing color, it will glow, signalling that you won a 10-cent Jackpot.</p>"
        +'<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>Each time you win a 10-cent Jackpot, you will see this image.</p>"
        +"<img src='img/jackpot.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>Please keep in mind that the <span class='green-span'>green</span> tiles change color very quickly...</p>"
        +'<div class="box" style="background-color:#00aa00"></div>'
        +"</div>"]

        var punishIntro = [
        "<div class='parent'>"
        +"<p>Specifically, they very quickly turn <span class='red-span'>red</span>...</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If a tile turns <span class='red-span'>red</span> before you activate it, you will lose two cents...</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and you will see this image.</p>"
        +"<img src='img/lose.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>In summary, you will win a 10-cent Jackpot each time you stop a <span class='green-span'>green</span> tile from changing color...</p>"
        +'<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...but each time a tile turns <span class='red-span'>red</span> before you activate it, you will lose two cents.</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>"]

        var neutralIntro = [
        "<div class='parent'>"
        +"<p>Specifically, they very quickly turn <span class='blue-span'>blue</span>...</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If a tile turns <span class='blue-span'>blue</span> before you activate it, you will earn zero cents...</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and you will see this image.</p>"
        +"<img src='img/none.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>In summary, you will win a 10-cent Jackpot each time you stop a <span class='green-span'>green</span> tile from changing color...</p>"
        +'<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...but each time a tile turns <span class='blue-span'>blue</span> before you activate it, you will earn zero cents.</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>"]

        var threeStateIntro = [
        "<div class='parent'>"
        +"<p>Half the time they turn <span class='red-span'>red</span>...</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and half the time they turn <span class='blue-span'>blue</span>.</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If a tile turns <span class='blue-span'>blue</span> before you activate it, you will gain zero cents...</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and you will see this image.</p>"
        +"<img src='img/nope.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>If a tile turns <span class='red-span'>red</span> before you activate it, you will lose two cents...</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and you will see this image.</p>"
        +"<img src='img/lose.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>In summary, you will win a 10-cent Jackpot each time you stop a <span class='green-span'>green</span> tile from changing color...</p>"
        +'<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...but each time a tile turns <span class='blue-span'>blue</span> before you activate it, you will earn zero cents...</p>"
        +'<div class="box" style="background-color:#1067e8"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>...and each time a tile turns <span class='red-span'>red</span> before you activate it, you will lose two cents.</p>"
        +'<div class="box" style="background-color:#cf0000"></div>'
        +"</div>"]


        // LoMI to HiMI Instructions
        var R2Intro_A = [
        "<div class='parent'>"
        +"<p>Thank you for playing the "+R1Span+"!</p>"
        +"When you're ready, press your SPACEBAR to continue to the "+R2Span+".</p>"
        +"</div>"]

        var R2Intro_B = [
        "<div class='parent'>"
        +"<p>The "+R2Span+" is identical to the "+R1Span+" with three exceptions.</p>"
        +"</div>",
        "<div class='parent'>"
        +"<p>First, in the "+R2Span+", tiles turn "+R2ColorWord+" if activated.</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>Second, in the "+R2Span+", if you turn a tile "+R2ColorWord+", "
        +"<br>your odds of winning a 10-cent Jackpot that trial are "+R2BestOdds+" (instead of "+R1BestOdds+")...</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +'<p>...and if a tile disappears before you turn it '+R2ColorWord+', '
        +"<br>your odds of winning a 10-cent Jackpot that trial are "+R2WorstOdds+" (instead of "+R1WorstOdds+").</p>"
        +"</div>",
         "<div class='parent'>"
        +"<p>Finally, in the "+R2Span+", you'll have time to activate the tiles."
        +"<br>Thus, in the "+R2Span+", .</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If you have read and understood the instructions, please continue to play the "+R2Span+"."
        +"<br>To re-read any of the instructions, press the 'previous' button to navigate back.</p>"
        +"</div>"]

        var scale_4 = ["blah"]

        var CompChk_Green = {
            type: 'html-button-response',
            stimulus:'<p>To make sure you understand the rules of the <span class="green-span">Green Game</span>, '
            +'please answer the following question:</p>'
            +'<p>What happens each time you stop a <span class="green-span">green</span> tile from changing color?</p>',
            choices: ["I win a 10-cent Jackpot", "I gain zero cents", "I lose two cents"],
            on_finish: function(data){
                compchk_g = data.button_pressed;
                console.log(compchk_g);
            },
        };

        var CompChk_Blue = {
            type: 'html-button-response',
            stimulus:'<p>To make sure you understand the rules of the <span class="green-span">Green Game</span>, '
            +'please answer the following question:</p>'
            +'<p>What happens each time a tile turns <span class="blue-span">blue</span> before you activate it?</p>',
            choices: ["I win a 10-cent Jackpot", "I gain zero cents", "I lose two cents"],
            on_finish: function(data){
                compchk_b = data.button_pressed;
                console.log(compchk_b);
            },
        };

        var CompChk_Red = {
            type: 'html-button-response',
            stimulus:'<p>To make sure you understand the rules of the <span class="green-span">Green Game</span>, '
            +'please answer the following question:</p>'
            +'<p>What happens each time a tile turns <span class="red-span">red</span> before you activate it?</p>',
            choices: ["I win a 10-cent Jackpot", "I gain zero cents", "I lose two cents"],
            on_finish: function(data){
                compchk_r = data.button_pressed;
                console.log(compchk_r);
            },
        };

        var CompChk_Button = {
            type: 'html-button-response',
            stimulus:'<p>To make sure you understand the rules of the <span class="green-span">Green Game</span>, '
            +'please answer the following question:</p>'
            +'<p>What button must you press to stop <span class="green-span">green</span> tiles from changing color?</p>',
            choices: ["ENTER", "SPACEBAR", "TAB"],
            on_finish: function(data){
                compchk_button = data.button_pressed;
                console.log(compchk_button);
            },
        };

        var T1a = {
            type: "instructions",
            pages: Intro1,
            key_forward: 32,
        }

        var T1b = {
            type: "instructions",
            pages: Intro2,
            key_forward: 32,
        }
        var T1_3State = {
            type: "instructions",
            pages: threeStateIntro,
            key_forward: 32,
        }

        var T1_Punish = {
            type: "instructions",
            pages: punishIntro,
            key_forward: 32,
        }

        var T1_Neutral = {
            type: "instructions",
            pages: neutralIntro,
            key_forward: 32,
        }

        var ErrorMessage = {
            type: "instructions",
            pages: ["<div class='parent'>"
            +"<p>You provided the wrong answer.<br>To make sure you understand how to play, please continue to re-read the instructions.</p>"
            +"</div>"],
            key_forward: 32,
        }

        var threeStateConditionalNode = {
            timeline: [ErrorMessage],
            conditional_function: function(){
                if(compchk_g == 0 && compchk_b == 1 && compchk_r == 2 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var neutralConditionalNode = {
            timeline: [ErrorMessage],
            conditional_function: function(){
                if(compchk_g == 0 && compchk_b == 1 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var punishConditionalNode = {
            timeline: [ErrorMessage],
            conditional_function: function(){
                if(compchk_g == 0 && compchk_r == 1 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var threeStateLoopNode = {
            timeline: [T1b, T1_3State, CompChk_Green, CompChk_Blue, CompChk_Red, CompChk_Button, threeStateConditionalNode],
            loop_function: function(){
                if(compchk_g == 0 && compchk_b == 1 && compchk_r == 2 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var neutralLoopNode = {
            timeline: [T1b, T1_Neutral, CompChk_Green, CompChk_Blue, CompChk_Button, neutralConditionalNode],
            loop_function: function(){
                if(compchk_g == 0 && compchk_b == 1 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var punishLoopNode = {
            timeline: [T1b, T1_Punish, CompChk_Green, CompChk_Red, CompChk_Button, punishConditionalNode],
            loop_function: function(){
                if(compchk_g == 0 && compchk_r == 2 && compchk_button == 1){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var T1c = {
            type: "instructions",
            pages: ["<div class='parent'>"
            +"<p>You are now ready to play the "+R1Span+".</p>"
            +"<p>Once you proceed, the "+R1Span+" will start immediately, "
            +"so get ready to press your SPACEBAR.</p>"
            +"<p>Continue to to begin.</p>"
            +"</div>"],
            key_forward: 32,
            post_trial_gap: 500,
        }

        timeline.push(welcome)


        // Create Trials

        var Delay = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'ITI'},
            stimulus: '<div class="box" style="background-color:white"></div>',
            choices: [32],
            trial_duration: function(){
                return jsPsych.randomization.sampleWithoutReplacement(ITI, 1)[0];
            },
            on_finish: function(data){
                if(data.key_press == 32){
                    data.TooFast = 1;
                } else if(data.key_press != 32 && tNum < 9){
                    data.TooFast = 0;
                    tNum = tNum + 1;
                } else if(data.key_press != 32 && tNum == 9){
                    data.TooFast = 0;
                    tNum = 0;
                    pM50 = jsPsych.randomization.shuffle(pM50);
                    missoutcome = jsPsych.randomization.shuffle(missoutcome);
                }
            },
        }

        var TooFast = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Too_Fast_Message'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return "<div style='font-size: 20px'><p>Too Fast!</p>"+
                    "<p>Please wait for the tile to turn green before pressing your SPACEBAR</p></div>"
                } else {
                    return ""
                }
            },
            trial_duration: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return 2500
                } else {
                    return 0
                }
            },
            post_trial_gap: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return 1000;
                } else {
                    return 0
                }
            },
            choices: jsPsych.NO_KEYS,
        }

        var TaskLoop = {
            timeline: [Delay, TooFast],
            loop_function: function(){
                if(jsPsych.data.get().last(2).values()[0].key_press != 32){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var Probe = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Probe'},
            stimulus: '<div class="box" style="background-color:#00aa00"></div>',
            choices: [32],
            trial_duration: function(){
                return pM50[tNum];
            },
            on_finish: function(data){
                if(data.key_press == 32 && tNum < 9){
                    data.TooSlow = 0;
                } else if(data.key_press != 32 && tNum < 9){
                    data.TooSlow = 1;
                } else if(data.key_press == 32 && tNum == 9){
                    data.TooSlow = 0;
//                    tNum = -1;
//                    pM50 = jsPsych.randomization.shuffle(pM50);
//                    missoutcome = jsPsych.randomization.shuffle(missoutcome);
                } else if(data.key_press != 32 && tNum == 9){
                    data.TooSlow = 1;
//                    tNum = -1;
//                    missoutcome = jsPsych.randomization.shuffle(missoutcome);
                }
            },
        }

        var Response_3State = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Response_3State'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return '<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>';
                } else {
                    return '<div class="box" style="background-color:'+missoutcome[tNum]+'"></div>';
                }
            },
            choices: [32],
            response_ends_trial: false,
            trial_duration: 1000,
        }

        var Response_Neutral = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Response_Neutral'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return '<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>';
                } else {
                    return '<div class="box" style="background-color:#1067e8"></div>';
                }
            },
            choices: [32],
            response_ends_trial: false,
            trial_duration: 1000,
        }

        var Response_Punish = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Response_Punish'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return '<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>';
                } else {
                    return '<div class="box" style="background-color:#cf0000"></div>';
                }
            },
            choices: [32],
            response_ends_trial: false,
            trial_duration: 1000,
        }

        var Feedback = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Feedback'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].stimulus == '<div class="box" style="background-color:#00aa00; box-shadow: 0px 0px 40px 20px #FFDF00"></div>'){
                    return "<img src='img/jackpot.png' class='rewardimg'>";
                } else if (jsPsych.data.get().last(1).values()[0].stimulus == '<div class="box" style="background-color:#1067e8"></div>'){
                    return "<img src='img/nope.png' class='rewardimg'>";
                } else if (jsPsych.data.get().last(1).values()[0].stimulus == '<div class="box" style="background-color:#cf0000"></div>'){
                    return "<img src='img/lose.png' class='rewardimg'>";
                }
            },
            on_finish: function(data){
                if(data.stimulus == "<img src='img/jackpot.png' class='rewardimg'>"){
                    data.Jackpot = "jackpot";
                } else if (data.stimulus == "<img src='img/nope.png' class='rewardimg'>"){
                    data.Jackpot = "nothing";
                } else if (data.stimulus == "<img src='img/lose.png' class='rewardimg'>"){
                    data.Jackpot = "punish";
                }
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
        }

        var Procedure_3State = {
            timeline: [TaskLoop, Probe, Response_3State, Feedback],
            repetitions: 50,
        }

        var Procedure_Neutral = {
            timeline: [TaskLoop, Probe, Response_Neutral, Feedback],
            repetitions: 50,
        }

        var Procedure_Punish = {
            timeline: [TaskLoop, Probe, Procedure_Punish, Feedback],
            repetitions: 50,
        }

        var scale_1 = [
            "0<br>Not<br>at all",
            "1", "2", "3", "4", "5", "6", "7",
            "8<br>Extremely",
        ];

        var scale_2 = [
            '0<br><div style="font-size:12px">Zero<br>Control</div>',
            "1", "2", "3", "4", "5", "6", "7",
            '8<br><div style="font-size:12px">Complete<br>Control</div>',
        ];

        var scale_3 = [
            '-4<br><div style="font-size:12px">Way<br>Too<br>Easy</div>',
            "-3",
            "-2",
            "-1",
            '0<br><div style="font-size:12px">Just<br>Right</div>',
            "1",
            "2",
            "3",
            '4<br><div style="font-size:12px">Way<br>Too<br>Hard</div>',
        ];

        var scale_5 = [
            "0<br>Not<br>at all",
            "1", "2", "3", "4", "5", "6", "7",
            "8<br>A lot",
        ];

        var Attention = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px">'
                +'<p>Thank you for playing the '+R1Span+'!</p>'
                +'<p>Now, please provide your honest assessment of the '+R1Span
                +' by answering each of the following questions.</div>',
            questions: [
                {prompt: 'How engaging was the '+R1Span+'?',
                name: 'R1_Engaging',
                labels: scale_1},
                {prompt: 'How engrossing was the '+R1Span+'?',
                name: 'R1_Engrossing',
                labels: scale_1},
                {prompt: 'How immersive was the '+R1Span+'?',
                name: 'R1_Immersive',
                labels: scale_1},
                {prompt: 'How addictive was the '+R1Span+'?',
                name: 'R1_Addictive',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var Valence = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'How much did you like the '+R1Span+'?',
                name: 'R1_Like',
                labels: scale_5},
                {prompt: 'How much did you dislike the '+R1Span+'?',
                name: 'R1_Dislike',
                labels: scale_5},
                {prompt: 'How enjoyable was the '+R1Span+'?',
                name: 'R1_Enjoyable',
                labels: scale_1},
                {prompt: 'How fun was the '+R1Span+'?',
                name: 'R1_Fun',
                labels: scale_1},
                {prompt: 'How entertaining was the '+R1Span+'?',
                name: 'R1_Entertaining',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var CtrlBal = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'While playing the '+R1Span+', how much control did you feel you had over the outcome of each trial?',
                name: 'R1_Control',
                labels: scale_2},
                {prompt: 'Was the '+R1Span+' too easy, too hard, or just the right level of difficulty?',
                name: 'R1_Balance',
                labels: scale_3},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        if (GameType == 1) {
            var test_procedure = {
                timeline: [T1a, threeStateLoopNode, T1c, Procedure_3State, Attention, Valence, CtrlBal],
            }
        } else if (GameType == 2) {
            var test_procedure = {
                timeline: [T1a, punishLoopNode, T1c, Procedure_Punish, Attention, Valence, CtrlBal],
            }
        } else if (GameType == 3) {
            var test_procedure = {
                timeline: [T1a, neutralLoopNode, T1c, Procedure_Neutral, Attention, Valence, CtrlBal],
            }           
        }

        timeline.push(test_procedure)
    
    
    
////////////////// Ryan's edits for in-lab study //////////////////
    
    var E_gender = {
        type: 'html-button-response',
        stimulus: '<p>Gender:</p>',
        choices: ['Male', 'Female','Other'],
    };
    timeline.push(E_gender);  
      
      
    var E_age = {
          type: 'survey-text',
          questions: [
            {prompt: "Age:",
            name: "E_age"},
          ],
        }; 
    timeline.push(E_age);
    
    var E_ethnicity = {
        type: 'html-button-response',
        stimulus: '<p>Ethnicity:</p>',
        choices: ['White / Caucasian', 'Black / African American','Asian / Pacific Islander', 'Hispanic', 'Native American', 'Other'],
    };
    timeline.push(E_ethnicity);  
    
    var E_english = {
        type: 'html-button-response',
        stimulus: '<p>Is English your native language?:</p>',
        choices: ['Yes', 'No'],
    };
    timeline.push(E_english);  
    
    
    var E_finalword = {
          type: 'survey-text',
          questions: [
            {prompt: "Questions? Comments? Complains? Provide your feedback here!",
            rows: 10,
            columns: 100,
            name: "E_finalword"},
          ],
        }; 
    timeline.push(E_finalword);
        
    var E_email = {
        type: 'survey-text',
        questions: [
            {prompt: "",
            placeholder: "Email Address", 
            name: "E_email", 
            columns: 50,
            required: true}
        ],
        preamble: function(){
            var R1_JackPotTrials = jsPsych.data.get().filter({Trial_Type: 'Feedback_R1', Jackpot: true});
            var R2_JackPotTrials = jsPsych.data.get().filter({Trial_Type: 'Feedback_R2', Jackpot: true});
            var R1_TotalJackpots = R1_JackPotTrials.count();
            var R2_TotalJackpots = R2_JackPotTrials.count();
            var totaljackpots = R1_TotalJackpots + R2_TotalJackpots;         
            var totalbonus = totaljackpots/10;
            var totaldollars = (Math.round(totalbonus * 100) / 100).toFixed(2)         

            return '<p>Thank you for participating!</p><p>In total, you got <b>'+totaljackpots+' Jackpots</b>, which is worth <b>$'+totaldollars+'</b> in bonus money!<br>Within one week, you will receive your bonus money, plus $5 for your participation.</p><p>To receive payment, enter your email address in the space below. If you with to forgo payment, type NA. <b>After you submit, you will see a blank screen, which indicates that your submission was successful</b>.</p>'
        },
        button_label: ['CLICK HERE TO FINISH']
    };
    timeline.push(E_email);
    
    
    
  // WRITE TO DATABASE
        jsPsych.init({
            timeline: timeline, 
            on_finish: function() {
                firebase.database().ref(firebase.auth().currentUser.uid).set({
                    data: jsPsych.data.get().values()
                })
            }
        });
    
    
                
/////////////////////////////////////////////////
        
        
        
    
    
    

    
    </script>

<!--
    <script>
        db.collection("tasks").doc('new_task').collection('subjects').doc(uid).update({
            date: new push().toLocaleDateString(),
            time: new Date().toLocaleTimeString()
        });
    </script>
-->

</html>
